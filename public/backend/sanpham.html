<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<title>Quản lí sản phẩm</title>

<meta name="robots" content="noindex, nofollow" />

<link rel="shortcut icon" href="images/icon.png" type="image/x-icon"/>
<link rel="stylesheet" type="text/css" href="crown/css/main.css" />
<link rel="stylesheet" type="text/css" href="css/css.css" media="screen" />
</head>

<body>
	
	<!-- Left side content -->
	<div id="left_content">
		<div id="leftSide" style="padding-top:30px;">
		
		    <!-- Account panel -->
			
<div class="sideProfile">
	<a href="#" title="" class="profileFace"><img width="40" src="images/user.png" /></a>
	<span>Xin chào: <strong> admin
							<span style="text-transform:uppercase">Lê Quang Ngọc An!</strong></span>
	
	<div class="clear"></div>
</div>
<div class="sidebarSep"></div>		    
		    <!-- Left navigation -->
			
<ul id="menu" class="nav">

			<li class="home">
		
			<a href="home.html">
				<span>Bảng điều khiển</span>
				<strong></strong>
			</a>
			
						
		</li>
			<li class="product">
		
			<a href="danhmuc.html">
				<span>Quản lý danh mục </span>
			</a>
						
		</li>
		<li class="product">
		
			<a href="sanpham.html"  class="active" id="current">
				<span>Quản lý sản phẩm</span>
			</a>
						
		</li>
			<li class="account">
		
			<a href="taikhoan.html"  >
				<span>Quản lý tài khoản</span>
				
			</a>
						
		</li>
		<li class="product">
		
			<a href="tintuc.html"  >
				<span>Quản lý tin tức</span>
				
			</a>
						
		</li>
		<li class="content">
		
			<a href="binhluan.html" >
				<span>Quản lý bình luận</span>
			</a>
		</li>
		<li class="content">
		
			<a href="donhang.html" >
				<span>Quản lý đơn hàng</span>
			</a>
		</li>
			<li class="content">
		
			<a href="slide.html" >
				<span>Quản lý slide</span>
			</a>
		</li>
		<li class="content">
			
				<a href="quangcao.html" >
					<span>Quản lý quảng cáo</span>
				</a>
		</li>
		<li class="content">
			
				<a href="lienhe.html" >
					<span>Quản lý liên hệ</span>
				</a>
		</li>
		<li class="content">
			
				<a href="setting.html" >
					<span>Quản lý setting</span>
				</a>
		</li>
</ul>
			
		</div>
		<div class="clear"></div>
	</div>
	
	
	<!-- Right side -->
	<div id="rightSide">
	
	    <!-- Account panel top -->
		
<div class="topNav">
	<div class="wrapper">
		
		<div class="userNav">
			<ul>
				<li><a href="../index.html" target="_blank">
					<img style="margin-top:7px;" src="images/icons/light/home.png" />
					<span>Trang chủ</span>
				</a></li>
				
				<!-- Logout -->
				
				
			</ul>
		</div>
		
		<div class="clear"></div>
	</div>
</div>
		
	    <!-- Main content -->
		
<!-- Title area -->
<div class="titleArea">
	<div class="wrapper">
		<div class="pageTitle">
			<h5>Sản phẩm</h5>
			<span>Trang quản lí sản phẩm</span>
		</div>
		<div class="horControlB menu_action">
			<ul>
				<li><a href="themsanpham.html">
					<img src="images/icons/control/16/add.png" />
					<span>Thêm mới</span>
				</a></li>
			</ul>
		</div>
		<div class="clear"></div>
	</div>
</div>

<div class="line"></div>
<!-- Message -->
<!-- Main content wrapper -->
<!-- Main content wrapper -->
<!-- Main content wrapper -->
<div class="wrapper" id="main_product">
	<div class="widget">
	
		<div class="title">
			<h6>
				Danh sách sản phẩm			</h6>
		 	<div class="num f12">Số lượng: <b>0</b></div>
		</div>
		
		<table cellpadding="0" cellspacing="0" width="100%" class="sTable mTable myTable" id="show">
			
			<thead class="filter"><tr><td colspan="12">
				<form class="list_filter form" action="" >
					<table cellpadding="0" cellspacing="0" width="80%"><tbody>
						<tr>
							<td class="label" style="width:40px;"><label for="filter_id">Mã số</label></td>
							<td class="item"><input name="search_id" value="" type="text" style="width:55px;" /></td>
							
							<td class="label" style="width:40px;"><label for="filter_id">Tên</label></td>
							<td class="item" style="width:155px;" ><input name="search_name" value=""  type="text" style="width:155px;" /></td>
							<td style='width:150px'>
							<button type="button" class="button blueB" onclick="loc()" >Lọc</button>
							<input type="reset" class="basic" value="Reset" onclick="window.location.href = 'sanpham.html'; ">
							</td>
							
						</tr>
					</tbody></table>
				</form>
			</td></tr></thead>
			
			<thead>
				<tr>
					<td style="width:60px;">Mã số</td>
					<td>Tên</td>
					<td>Danh mục</td>
					<td>Giá</td>
					<td>Review</td>
					<td>Chi tiết</td>
					<td>Số lượng</td>
					<td style="width:70px;">Ngày tạo</td>
					<td style="width:120px;">Hành động</td>
				</tr>
			</thead>
			<tbody class="list_item"></tbody>
		</table>
	</div>
	<div style="clear: both;padding-top: 10px" class="block col-md-2">
		<div id="main">
		  <div class="container">
		    <div class="row">
		      <div class="block col-md-2">
		        <a href="file:///C:/Anlqnph07584_Assignment_Web206/public/backend/sanpham.html" class="btn btn-3" style="padding: 1em" id="pages1">1</a>
		        <a href="file:///C:/Anlqnph07584_Assignment_Web206/public/backend/sanpham.html?page=2" class="btn btn-3" style="padding: 1em" id="pages2">2</a>
		        <a href="file:///C:/Anlqnph07584_Assignment_Web206/public/backend/sanpham.html?page=3" class="btn btn-3" style="padding: 1em" id="pages3">3</a>
		        <a href="file:///C:/Anlqnph07584_Assignment_Web206/public/backend/sanpham.html?page=4" class="btn btn-3" style="padding: 1em" id="pages4">4</a>
		      </div>
		    </div>
		  </div>
		</div>
	</div>
</div>		<div class="clear mt30"></div>
		
	    <!-- Footer -->
	    <div id="footer">
	    		        <div class="wrapper">

	        	<div>Bản quyền © 2019 Lê Quang Ngọc An</div>
	        </div>
	     </div>
	</div>
	<div class="clear"></div>
	<script type="text/javascript">
			var url = "http://localhost:3000/sanpham";
			var listdata = "";

			/* Hiển thị tên danh mục */
			var url_dm = "http://localhost:3000/danhmuc";
			console.log(url_dm);
			fetch(url_dm, {
            method: "GET"
        	}).then(function(res) {
            	return res.json(); // chuyển chuỗi nhận được thành đối tượng json
       		}).then(function(data) {
       			listdata = data;
       			for(var i = 0; i < data.length ; i ++){
		       			$(document).ready(function(){
		       				if(iddm == data[i].id){
		       					$("#showdm").prepend("<option value="+iddm+" selected=selected>"+data[i].tendm+"</option>");
		       				}else{
		       					$("#showdm").append("<option value="+data[i].id+">"+data[i].tendm+"</option>");
		       				}
		       			})
	       		}
       		})
       	/* Kết thúc hiển thị tên danh mục */
       	var dkurl = window.location.href;
            console.log(dkurl);
            if(dkurl =="file:///C:/Anlqnph07584_Assignment_Web206/public/backend/sanpham.html"){
                var a = document.querySelector("#pages1").innerText;
                console.log(a);
                var url = "http://localhost:3000/sanpham?_page="+a+"&_limit=5";
            }else if(dkurl =="file:///C:/Anlqnph07584_Assignment_Web206/public/backend/sanpham.html?page=2"){
                var a = document.querySelector("#pages2").innerText;
                console.log(a);
                var url = "http://localhost:3000/sanpham?_page="+a+"&_limit=5";
            }else if(dkurl =="file:///C:/Anlqnph07584_Assignment_Web206/public/backend/sanpham.html?page=3"){
                var a = document.querySelector("#pages3").innerText;
                console.log(a);
                var url = "http://localhost:3000/sanpham?_page="+a+"&_limit=5";
            }else if(dkurl =="file:///C:/Anlqnph07584_Assignment_Web206/public/backend/sanpham.html?page=4"){
                var a = document.querySelector("#pages4").innerText;
                console.log(a);
                var url = "http://localhost:3000/sanpham?_page="+a+"&_limit=5";
            }
			console.log(url);
			fetch(url, {
            method: "GET"
        	}).then(function(res) {
            	return res.json(); // chuyển chuỗi nhận được thành đối tượng json
       		}).then(function(data) {
            // các lệnh xử lý cho dữ liệu ở đây: các công việc hiển thị.
            	console.log(data);
            	var bang = document.querySelector('#show');
	            for (i = 0; i < data.length; i++) {
	                var obj = data[i];
	                // Tạo thêm 1 dòng ở cuối bảng bằng cú pháp sau
	                let dong_moi = bang.insertRow(-1);

	                // Thêm ô thứ nhất, chỉ số thứ tự là 0, ô này dùng để hiển thị ID
	                let o1 = dong_moi.insertCell(0);
	                o1.innerText = obj.id;

	                // Thêm ô thứ hai, chỉ số thứ tự là 1, ô này dùng để hiển thị tên sản phẩm, ảnh, số bán ra, view
	                let o2 = dong_moi.insertCell(1);
	                o2.innerHTML = '<div class="image_thumb"><img src="../frontend/images/product/'+obj.image+'" style="width: 80px;height:auto"><div class="clear"></div></div><b>'+obj.tensp+'</b><div class="f11" style="clear: both;">Đã bán:'+obj.banra+'| Xem: '+obj.view+'</div>';

	                //Thêm ô thứ ba, chỉ số thứ tự là 2, ô này dùng để hiển thị danh mục
	                var o3 = dong_moi.insertCell(2);
	                for(var j=0; j<listdata.length; j++){
	                	var datadm = listdata[j];
	                	if(datadm.id == obj.iddm){
	                		o3.innerText = datadm.tendm;
	                	}
	                }

	                //Thêm ô thứ tư, chỉ số thứ tự là 3, ô này dùng để hiển thị giá, giá khuyến mãi
	                let o4 = dong_moi.insertCell(3);
	                o4.innerHTML = obj.gia+"<p style='text-decoration:line-through'>"+obj.giakm+"</p>";

	                //Thêm ô thứ năm, chỉ số thứ tự là 4, ô này dùng để hiển thị review
	                let o5 = dong_moi.insertCell(4);
	                o5.innerHTML = "<details><summary>Review sản phẩm</summary>"+obj.review+" </details>";

	                //Thêm ô thứ sáu, chỉ số thứ tự là 5, ô này dùng để hiển thị chi tiết
	                let o6 = dong_moi.insertCell(5);
	                o6.innerHTML = "<details><summary>Chi tiết sản phẩm</summary>"+obj.chitiet+" </details>";

	                //Thêm ô thứ bảy, chỉ số thứ tự là 6, ô này dùng để hiển thị số lượng
	                let o7 = dong_moi.insertCell(6);
	                o7.innerText = obj.soluong;

	                //Thêm ô thứ tám, chỉ số thứ tự là 7, ô này dùng để hiển thị ngày tạo
	                let o8 = dong_moi.insertCell(7);
	                o8.innerText = obj.thoigian;

	                // Thêm ô thứ tám, chỉ số thứ tự là 7, ô này dùng để tao tác với tài khoản
	                let o9 = dong_moi.insertCell(8);
	                o9.innerHTML = '<a href="suasanpham.html?idsp='+obj.id+'&iddm='+obj.iddm+'" title="Chỉnh sửa" class="tipS"><img src="images/icons/color/edit.png" /></a>	<a href="#" onclick="xoasp('+obj.id+')" title="Xóa" class="tipS verify_action" ><img src="images/icons/color/delete.png" /></a>';
	            }
			})
			function xoasp(id){
				var url_xoa = 'http://localhost:3000/sanpham/'+id;
				var xacNhan = confirm("Bạn có chắc muốn xóa sản phẩm?");
				if(xacNhan){
					fetch(url_xoa, {
						method: "DELETE"
					}).then(function(res){
						return res.json; //trả về dữ liệu dạng json
					}).then(function(data){
						location.reload();
					});
				}
			}
		</script>
</body>
</html>