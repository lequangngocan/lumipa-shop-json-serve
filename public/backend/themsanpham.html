<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<title>Thêm mới sản phẩm</title>

<meta name="robots" content="noindex, nofollow" />

<link rel="shortcut icon" href="images/icon.png" type="image/x-icon"/>
<link rel="stylesheet" type="text/css" href="crown/css/main.css" />
<link rel="stylesheet" type="text/css" href="css/css.css" media="screen" />
<script type="text/javascript" src="ckeditor_4.13.0_standard/ckeditor/ckeditor.js"></script> 
<script type="text/javascript" src="../js/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.1/dist/jquery.validate.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.1/dist/additional-methods.min.js"></script>

</head>

<body>
	
	<!-- Left side content -->
	<div id="left_content">
		<div id="leftSide" style="padding-top:30px;">
		
		    <!-- Account panel -->
			
<div class="sideProfile">
	<a href="#" title="" class="profileFace"><img width="40" src="images/user.png" /></a>
	<span>Xin chào: <strong> admin
							<span style="text-transform:uppercase">Lê Quang Ngọc An!</strong></span>
	
	<div class="clear"></div>
</div>
<div class="sidebarSep"></div>		    
		    <!-- Left navigation -->
			
<ul id="menu" class="nav">

			<li class="home">
		
			<a href="home.html">
				<span>Bảng điều khiển</span>
				<strong></strong>
			</a>
			
						
		</li>
			<li class="product">
		
			<a href="danhmuc.html">
				<span>Quản lý danh mục </span>
			</a>
						
		</li>
		<li class="product">
		
			<a href="sanpham.html"  class="active" id="current">
				<span>Quản lý sản phẩm</span>
			</a>
						
		</li>
			<li class="account">
		
			<a href="taikhoan.html"  >
				<span>Quản lý tài khoản</span>
				
			</a>
						
		</li>
		<li class="product">
		
			<a href="tintuc.html"  >
				<span>Quản lý tin tức</span>
				
			</a>
						
		</li>
		<li class="content">
		
			<a href="binhluan.html" >
				<span>Quản lý bình luận</span>
			</a>
		</li>
		<li class="content">
		
			<a href="donhang.html" >
				<span>Quản lý đơn hàng</span>
			</a>
		</li>
			<li class="content">
		
			<a href="slide.html" >
				<span>Quản lý slide</span>
			</a>
		</li>
		<li class="content">
			
				<a href="quangcao.html" >
					<span>Quản lý quảng cáo</span>
				</a>
		</li>
		<li class="content">
			
				<a href="lienhe.html" >
					<span>Quản lý liên hệ</span>
				</a>
		</li>
		<li class="content">
			
				<a href="setting.html" >
					<span>Quản lý setting</span>
				</a>
		</li>
</ul>
			
		</div>
		<div class="clear"></div>
	</div>
	
	
	<!-- Right side -->
	<div id="rightSide">
	
	    <!-- Account panel top -->
		
<div class="topNav">
	<div class="wrapper">
		
		<div class="userNav">
			<ul>
				<li><a href="home.html" target="_blank">
					<img style="margin-top:7px;" src="images/icons/light/home.png" />
					<span>Trang chủ</span>
				</a></li>
				
				<!-- Logout -->
				
				
			</ul>
		</div>
		
		<div class="clear"></div>
	</div>
</div>
		
	    <!-- Main content -->
		
<!-- Title area -->
<div class="titleArea">
	<div class="wrapper">
		<div class="pageTitle">
			<h5>Sản phẩm</h5>
			<span>Trang quản lí sản phẩm</span>
		</div>
		<div class="horControlB menu_action">
			<ul>
				<li><a href="sanpham.html">
					<img src="images/icons/control/16/list.png" />
					<span>Danh sách</span>
				</a></li>
			</ul>
		</div>
		<div class="clear"></div>
	</div>
</div>

<div class="line"></div>
<!-- Message -->
<!-- Main content wrapper -->
<!-- Main content wrapper -->
<!-- Main content wrapper -->
<div class="wrapper" id="main_product">
	<form class="form" action="sanpham.html" id="themsp">
			<fieldset>
				<div class="widget">
				    <div class="title">
						<img src="images/icons/dark/add.png" class="titleIcon" />
						<h6>Thêm mới sản phẩm</h6>
					</div>
					
				    <ul class="tabs">
		                <li><a href="#tab1">Thông tin chung</a></li>   
					</ul>
					
					<div class="tab_container">
						<div id='tab1' class="tab_content pd0">
							<div class="formRow">
								<label class="formLeft" >Tên sản phẩm:<span class="req">*</span></label>
								<div class="formRight">
									<span class="oneTwo"><input name="tensp" type="text" /></span><br>	
								<div class="clear"></div>
								<span id="tensp_error" style="color: red"></span>
							</div>
							</div>
		        		</div>
		        		<div id='tab2' class="tab_content pd0">
							<div class="formRow">
								<label class="formLeft" >Danh mục:<span class="req">*</span></label>
								<div class="formRight">
									<span class="oneTwo">
										<select name="danhmuc" id="showdm">
										</select>
									</span>
								<div class="clear"></div>
							</div>
							</div>
		        		</div>
		        		<div id='tab3' class="tab_content pd0">
							<div class="formRow">
								<label class="formLeft" >Ảnh sản phẩm:<span class="req">*</span></label>
								<div class="formRight">
									<span class="oneTwo"><input name="anhsp" type="file" /></span><br>
								<div class="clear"></div>
								<span id="anhsp_error" style="color: red"></span>
							</div>
							</div>
		        		</div>
		        		<div id='tab4' class="tab_content pd0">
							<div class="formRow">
								<label class="formLeft" >Giá:<span class="req">*</span></label>
								<div class="formRight">
									<span class="oneTwo"><input name="gia" type="text" /></span><br>
								<div class="clear"></div>
								<span id="gia_error" style="color: red"></span>
							</div>
							</div>
		        		</div>
		        		<div id='tab5' class="tab_content pd0">
							<div class="formRow">
								<label class="formLeft" >Giá khuyến mãi:<span class="req">*</span></label>
								<div class="formRight">
									<span class="oneTwo"><input name="giakm"  type="text"/></span><br>
								<div class="clear"></div>
								<span id="giakm_error" style="color: red"></span>
							</div>
							</div>
		        		</div>
		        		<div id='tab6' class="tab_content pd0">
							<div class="formRow">
								<label class="formLeft" >Review:<span class="req">*</span></label>
								<div class="formRight">
									<span class="oneTwo"><input name="review"  type="text"/></span><br>
								<div class="clear"></div>
								<span id="review_error" style="color: red"></span>
							</div>
							</div>
		        		</div>
		        		<div id='tab7' class="tab_content pd0">
							<div class="formRow">
								<label class="formLeft" >Chi tiết:<span class="req">*</span></label>
								<div class="formRight">
								<textarea id="chitiet" name="chitiet"></textarea>
								<script>CKEDITOR.replace('chitiet');</script>
								<span name="warranty_autocheck" class="autocheck"></span>
								<div name="warranty_error" class="clear error"></div>
							</div>
							</div>
		        		</div>
		        		<div id='tab8' class="tab_content pd0">
							<div class="formRow">
								<label class="formLeft" >Số lượng:<span class="req">*</span></label>
								<div class="formRight">
									<span class="oneTwo"><input name="soluong"  type="text"/></span><br>
								<div class="clear"></div>
								<span id="soluong_error" style="color: red"></span>
							</div>
							</div>
		        		</div>
		        		<!-- End tab_container-->
		        		<div class="formSubmit" >
		           			<button class="redB" onclick="saveAdd()" type="button">Thêm mới</button>
		           		</div>
		        		<div class="clear"></div>
					</div>
			</fieldset>
	</form>
	
</div>		<div class="clear mt30"></div>
		
	    <!-- Footer -->
	    <div id="footer">
	    		        <div class="wrapper">

	        	<div>Bản quyền © 2019 Lê Quang Ngọc An</div>
	        </div>
	     </div>
	</div>
	<div class="clear"></div>
	<script type="text/javascript">
			/* Hiển thị tên danh mục */
			var url_dm = "http://localhost:3000/danhmuc";
			console.log(url_dm);
			fetch(url_dm, {
            method: "GET"
        	}).then(function(res) {
            	return res.json(); // chuyển chuỗi nhận được thành đối tượng json
       		}).then(function(data) {
       			for(var i = 0; i < data.length ; i ++){
	       			$(document).ready(function(){
	       				$("#showdm").append("<option value="+data[i].id+">"+data[i].tendm+"</option>");
	       			})
	       		}
       		})
       		/* Kết thúc hiển thị tên danh mục */
       		function saveAdd(){
       		/* Lấy dữ liệu từ form về */
       		var tenSanPham = document.querySelector("input[name=tensp]").value;
       		console.log(tenSanPham);
       		var danhMuc = document.querySelector("#showdm").value;
       		console.log(danhMuc);
       		var anhSanPham = $('input[type=file]').val().split('\\').pop();
       		console.log(anhSanPham);
       		var gia = document.querySelector("input[name=gia]").value;
       		console.log(gia);
       		var giaKhuyenMai = document.querySelector("input[name=giakm]").value;
       		console.log(giaKhuyenMai);
       		var review = document.querySelector("input[name=review]").value;
       		console.log(review);
       		var chitiet = CKEDITOR.instances['chitiet'].getData();
			console.log(chitiet);
       		var soLuong = document.querySelector("input[name=soluong]").value;
       		console.log(soLuong);
       		var thoiGian = new Date();
			console.log(thoiGian);
       		/* Kết thúc lấy dữ liệu từ form */

       		/* Check form */
       		
       		// check tên sản phẩm
       		if(tenSanPham.length == 0){
       			document.querySelector("#tensp_error").innerText = "Bạn chưa nhập tên sản phẩm";
       			return false;
       		}else{
       			document.querySelector("#tensp_error").innerText = "";
       		}
       		// check ảnh sản phẩm
       		if(anhSanPham.length == 0){
       			document.querySelector("#anhsp_error").innerText = "Bạn chưa chọn ảnh sản phẩm";
       			return false;
       		}else{
       			document.querySelector("#anhsp_error").innerText = "";
       		}
       		// check giá sản phẩm
       		if(gia == 0){
       			document.querySelector("#gia_error").innerText = "Bạn chưa nhập giá sản phẩm";
       			return false;
       		}else if(isNaN(gia) == true){
       			document.querySelector("#gia_error").innerText = "Giá sản phẩm phải là 1 số ";
       			return false;
       		}else if( Number(gia) < 0){
       			document.querySelector("#gia_error").innerText = "Giá sản phẩm phải lớn hơn 0";
                return false;
       		}else{
       			document.querySelector("#gia_error").innerText = "";
       		}

       		// check giá khuyến mãi 
       		if(giaKhuyenMai == 0){
       			document.querySelector("#giakm_error").innerText = "Bạn chưa nhập giá khuyến mãi sản phẩm";
       			return false;
       		}else if(isNaN(giaKhuyenMai) == true){
       			document.querySelector("#giakm_error").innerText = "Giá khuyến mãi sản phẩm phải là 1 số ";
       			return false;
       		}else if( Number(giaKhuyenMai) < 0){
       			document.querySelector("#giakm_error").innerText = "Giá khuyến mãi sản phẩm phải lớn hơn 0";
                return false;
       		}else{
       			document.querySelector("#giakm_error").innerText = "";
       		}

       		// check review sản phẩm
       		if(review.length ==0){
       			document.querySelector("#review_error").innerText = "Bạn chưa nhập review";
       			return false;
       		}else{
       			document.querySelector("#review_error").innerText = "";
       		}

       		// check số lượng sản phẩm
       		if(soLuong == 0){
       			document.querySelector("#soluong_error").innerText = "Bạn chưa nhập số lượng";
       			return false;
       		}else if(isNaN(soLuong) == true){
       			document.querySelector("#soluong_error").innerText = "Số lượng phải là 1 số ";
       			return false;
       		}else if( Number(soLuong) < 0){
       			document.querySelector("#soluong_error").innerText = "Số lượng phải lớn hơn 0";
                return false;
       		}else{
       			document.querySelector("#soluong_error").innerText = "";
       		}
		    /* Kết thúc check form */

		    /* Gửi dữ liệu lên server */
		    var dataPost = {
		    	tensp: tenSanPham,
		    	gia: gia,
		    	giakm: giaKhuyenMai,
		    	review: review,
		    	chitiet: chitiet,
		    	image: anhSanPham,
		    	soluong: soLuong,
		    	thoigian: thoiGian,
		    	view: 0,
		    	banra: 0,
		    	iddm: danhMuc
		    }
		    var url_post = "http://localhost:3000/sanpham";

            fetch(url_post, {
                    method: 'POST', // thêm mới thì dùng post
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(dataPost), // chuyển dữ liệu object trên thành chuỗi json
                })
                .then((response) => response.json()) // chuyển kết quả trả về thành json object
                .then((data) => {

                    // bạn có thể làm gì đó với kết quả cuối cùng này thì làm
                    alert("Bạn đã thêm sản phẩm thành công");
                    window.location.replace('sanpham.html');
                    console.log('Success:', data); // ghi log kết quả hoàn thành
                })
                .catch((error) => {

                    console.error('Error:', error); // ghi log nếu xảy ra lỗi
                });
		   }
	</script>
</body>
</html>